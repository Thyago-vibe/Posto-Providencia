# ğŸ“‹ Cursor Rules - Posto ProvidÃªncia v3.0

> **Ãšltima AtualizaÃ§Ã£o:** 14/01/2026
> **Status do Projeto:** RefatoraÃ§Ã£o 100% ConcluÃ­da | ManutenÃ§Ã£o de Qualidade

---

## âš ï¸ REGRA ZERO - A Mais Importante

```
ENTENDA ANTES DE ENTREGAR.
Pergunte atÃ© ter absoluta clareza. CÃ³digo errado Ã© pior que nenhum cÃ³digo.
```

---

## ğŸŒ IDIOMA

- **100% PortuguÃªs (Brasil)** em tudo:
  - ComentÃ¡rios, variÃ¡veis em portuguÃªs quando fizer sentido (ex: `frentista`, `combustivel`)
  - JSDoc, mensagens de erro, logs
  - DocumentaÃ§Ã£o e commits

---

## ğŸ—ï¸ ARQUITETURA OBRIGATÃ“RIA

### Estrutura de Feature (PadrÃ£o InviolÃ¡vel)
```
src/components/nome-feature/
â”œâ”€â”€ index.tsx              # Orquestrador (mÃ¡x 150 linhas)
â”œâ”€â”€ types.ts               # Tipos locais (se necessÃ¡rio)
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useFeature.ts      # Hook principal de dados (mÃ¡x 200 linhas)
â”‚   â”œâ”€â”€ useActions.ts      # Hook de aÃ§Ãµes/mutations
â”‚   â””â”€â”€ useFilters.ts      # Hook de filtros (se aplicÃ¡vel)
â””â”€â”€ components/
    â”œâ”€â”€ Header.tsx         # CabeÃ§alho (mÃ¡x 250 linhas cada)
    â”œâ”€â”€ Summary.tsx        # Cards de resumo
    â”œâ”€â”€ Table.tsx          # Tabela/Lista
    â””â”€â”€ Filters.tsx        # Filtros
```

### Limites de Linhas por Arquivo
| Tipo de Arquivo | MÃ¡ximo |
|-----------------|--------|
| Componente Principal (index.tsx) | 150 linhas |
| Hooks | 200 linhas |
| Componentes UI | 250 linhas |
| Services | 300 linhas |

---

## ğŸ“ TYPESCRIPT ESTRITO

### Regra Absoluta: ZERO `any`
```typescript
// âŒ PROIBIDO - any em qualquer forma
const dados: any = {};
function processar(item: any) {}
(data as unknown as Tipo[])

// âœ… CORRETO - Tipos explÃ­citos
const dados: DadosFinanceiros = {};
function processar(item: Transacao) {}
(data || []) as Tipo[]
```

### Smart Types - PadrÃ£o de Tipos
```typescript
// âŒ NUNCA crie interfaces manuais para entidades do banco
interface Cliente {
  id: number;
  nome: string;
}

// âœ… SEMPRE derive dos tipos do Supabase
import type { ClienteTable } from '../../types/database/tables/clientes';
export type Cliente = ClienteTable['Row'];
export type CreateCliente = ClienteTable['Insert'];
export type UpdateCliente = ClienteTable['Update'];

// âœ… Use WithRelations para relacionamentos
import { WithRelations } from '../../types/ui/helpers';
export type ClienteComNotas = WithRelations<Cliente, { notas?: NotaFrentista[] }>;
```

### Interfaces Antes da ImplementaÃ§Ã£o
Sempre defina interfaces/tipos ANTES de implementar a lÃ³gica:
```typescript
// 1. Primeiro: defina o contrato
interface UseFinanceiroReturn {
  dados: DadosFinanceiros;
  carregando: boolean;
  erro: string | null;
  recarregar: () => Promise<void>;
}

// 2. Depois: implemente
export function useFinanceiro(filtros: FiltrosFinanceiros): UseFinanceiroReturn {
  // implementaÃ§Ã£o...
}
```

---

## ğŸ“š JSDoc OBRIGATÃ“RIO

### Em Todo Arquivo
```typescript
/**
 * Hook para gerenciamento de dados financeiros consolidados.
 *
 * Busca vendas, despesas, recebimentos e compras do perÃ­odo selecionado,
 * agregando em mÃ©tricas consolidadas de receita, despesa e lucro.
 */
```

### Em Toda Interface
```typescript
/**
 * Interface que representa uma transaÃ§Ã£o financeira unificada.
 */
export interface Transacao {
  readonly id: string;
  /** Tipo da transaÃ§Ã£o: receita (entrada) ou despesa (saÃ­da) */
  tipo: 'receita' | 'despesa';
  /** Categoria da transaÃ§Ã£o para agrupamento */
  categoria: string;
  /** Valor monetÃ¡rio da transaÃ§Ã£o */
  valor: number;
}
```

### Em Toda FunÃ§Ã£o Exportada
```typescript
/**
 * Hook principal para orquestraÃ§Ã£o de dados financeiros.
 * 
 * @param filtros - Filtros de data e contexto aplicados
 * @returns Dados agregados, estado de carregamento e funÃ§Ã£o de refresh
 */
export function useFinanceiro(filtros: FiltrosFinanceiros): UseFinanceiroReturn {
```

---

## ğŸ”„ RASTREIO DE MUDANÃ‡AS

Ao editar cÃ³digo existente, INSIRA um comentÃ¡rio acima da linha modificada:
```typescript
// [DD/MM HH:mm] O que mudou / Por quÃª
const novoValor = calcularNovo();
```

Exemplo real:
```typescript
// [14/01 15:40] Expondo tipos financeiros para uso centralizado em componentes
export interface Transacao { ... }
```

---

## ğŸŒ¿ GIT & CONTROLE DE VERSÃƒO

### Branches
| Tipo | Formato | Exemplo |
|------|---------|---------|
| Feature | `feature/<descricao>` | `feature/relatorio-vendas` |
| Bug Fix | `fix/<descricao>` | `fix/calculo-margem` |
| Refactor | `refactor/<descricao>` | `refactor/modularizar-hooks` |
| Issue | `refactor/#<numero>-<descricao>` | `refactor/#22-smart-types` |

### Commits SemÃ¢nticos
```bash
feat: adiciona dashboard de vendas
fix: corrige cÃ¡lculo de margem lÃ­quida
refactor: modulariza TelaGestaoFinanceira
docs: atualiza guia de Smart Types
chore: atualiza dependÃªncias
```

### Workflow ObrigatÃ³rio
1. **Sempre** vincule branch a uma Issue
2. **Sempre** faÃ§a PR para `main`
3. **Nunca** faÃ§a push direto para `main`
4. **Aguarde** CI passar antes de merge
5. **Documente** no CHANGELOG.md

---

## ğŸ› ï¸ STACK TECNOLÃ“GICA

| Tecnologia | VersÃ£o | Uso |
|------------|--------|-----|
| **Bun** | Latest | Runtime (6x mais rÃ¡pido que npm) |
| **React** | 19.x | UI Framework |
| **TypeScript** | 5.8+ | Tipagem estrita |
| **Vite** | 6.x | Build tool |
| **Supabase** | 2.x | Backend/Auth/DB |
| **Recharts** | 3.x | GrÃ¡ficos |
| **Lucide React** | 0.560+ | Ãcones |
| **Sonner** | 2.x | Toasts/NotificaÃ§Ãµes |

### Comandos PadrÃ£o
```bash
bun run dev      # Desenvolvimento (porta 3015)
bun run build    # Build de produÃ§Ã£o
bun run preview  # Preview do build
```

---

## ğŸ“ ESTRUTURA DE PASTAS DO PROJETO

```
src/
â”œâ”€â”€ components/           # Componentes organizados por feature
â”‚   â”œâ”€â”€ feature-name/     # Cada feature Ã© uma pasta
â”‚   â””â”€â”€ common/           # Componentes compartilhados
â”œâ”€â”€ contexts/             # Contextos React (Auth, Theme, etc.)
â”œâ”€â”€ hooks/                # Hooks globais compartilhados
â”œâ”€â”€ layouts/              # Layouts de pÃ¡gina
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ api/              # Services de API (um por entidade)
â”‚   â””â”€â”€ supabase.ts       # Cliente Supabase
â”œâ”€â”€ types/
â”‚   â”œâ”€â”€ database/         # Tipos derivados do Supabase
â”‚   â”‚   â””â”€â”€ tables/       # Um arquivo por tabela
â”‚   â””â”€â”€ ui/               # Tipos de UI e helpers
â”œâ”€â”€ utils/                # UtilitÃ¡rios puros
â””â”€â”€ constants.ts          # Constantes globais
```

---

## ğŸ¯ PRINCÃPIOS DE CÃ“DIGO

### 1. Simplicidade > Complexidade
```typescript
// âŒ Over-engineering
const resultado = array
  .filter(Boolean)
  .map(x => transform(x))
  .reduce((acc, curr) => ({ ...acc, [curr.id]: curr }), {});

// âœ… Claro e direto
const resultado: Record<string, Item> = {};
for (const item of array) {
  if (item) resultado[item.id] = transform(item);
}
```

### 2. Single Responsibility
- Um hook = uma responsabilidade
- Um componente = uma parte da UI
- Um service = uma entidade do banco

### 3. ComposiÃ§Ã£o sobre HeranÃ§a
```typescript
// âœ… Compose hooks
function useFeature() {
  const dados = useDados();
  const filtros = useFiltros();
  const acoes = useAcoes(dados.recarregar);
  
  return { ...dados, ...filtros, ...acoes };
}
```

### 4. Evite Verbosidade DesnecessÃ¡ria
```typescript
// âŒ Verbose
const handleClick = (event: React.MouseEvent<HTMLButtonElement>) => {
  event.preventDefault();
  onClick();
};

// âœ… Direto (se nÃ£o precisa do event)
const handleClick = () => onClick();
```

---

## âš ï¸ ANTI-PATTERNS PROIBIDOS

### 1. CÃ³digo Morto
Nunca deixe cÃ³digo comentado "para depois":
```typescript
// âŒ Proibido
// function antigaFuncao() { ... }
// const valorAntigo = 42;
```

### 2. Console.log em ProduÃ§Ã£o
Use apenas para debugging temporÃ¡rio, remova antes do commit:
```typescript
// âŒ NÃ£o commite isso
console.log('debug:', dados);
```

### 3. Magic Numbers/Strings
```typescript
// âŒ Magic numbers
if (margem > 15) { ... }

// âœ… Constantes nomeadas
const MARGEM_MINIMA_SAUDAVEL = 15;
if (margem > MARGEM_MINIMA_SAUDAVEL) { ... }
```

### 4. Props Drilling Excessivo
Se passar props por 3+ nÃ­veis, use Context ou refatore:
```typescript
// âŒ Props drilling
<Pai dado={dado}>
  <Filho dado={dado}>
    <Neto dado={dado}>
      <Bisneto dado={dado} />

// âœ… Context ou composiÃ§Ã£o
<DadoProvider value={dado}>
  <Pai><Filho><Neto><Bisneto /></Neto></Filho></Pai>
</DadoProvider>
```

---

## ğŸ”’ SEGURANÃ‡A

1. **Nunca** exponha chaves secretas em cÃ³digo
2. **Sempre** use variÃ¡veis de ambiente (`.env.local`)
3. **Nunca** commite arquivos `.env` com valores reais
4. **Sempre** valide inputs do usuÃ¡rio
5. **Sempre** use RLS (Row Level Security) no Supabase

---

## ğŸ“Š DOCUMENTAÃ‡ÃƒO OBRIGATÃ“RIA

### Ao Criar Nova Feature
1. Atualizar `CHANGELOG.md` com as mudanÃ§as
2. Criar PRD se for feature complexa
3. Documentar no `STATUS_DO_PROJETO.md` se relevante

### Ao Concluir Issue
1. Fechar issue no GitHub com comentÃ¡rio
2. Atualizar documentaÃ§Ã£o relacionada
3. Criar tag de versÃ£o se for release

---

## ğŸš¨ SE ALGO QUEBRAR

1. **NÃ£o entre em pÃ¢nico**
2. Verifique o Ãºltimo commit funcional
3. Use `git stash` se precisar salvar trabalho em andamento
4. Restaure via tags estÃ¡veis: `git checkout v3.0.0`
5. Consulte `docs/VERSOES_ESTAVEIS.md` para rollback

---

## ğŸ“– REFERÃŠNCIAS RÃPIDAS

| Documento | PropÃ³sito |
|-----------|-----------|
| `docs/GUIA-SMART-TYPES.md` | Como usar tipos derivados |
| `docs/GUIA-HOOKS-CUSTOMIZADOS.md` | PadrÃµes de hooks |
| `docs/STATUS_DO_PROJETO.md` | Estado atual do projeto |
| `docs/PLANO-REFATORACAO-COMPLETO.md` | HistÃ³rico de refatoraÃ§Ã£o |
| `CHANGELOG.md` | HistÃ³rico de mudanÃ§as |

---

## ğŸ¯ MANTRA DO PROJETO

```
âœ… Entender > Entregar rÃ¡pido
âœ… Simplicidade > Complexidade
âœ… Tipos fortes > Flexibilidade perigosa
âœ… CÃ³digo limpo > ComentÃ¡rios explicativos
âœ… Modular > MonolÃ­tico
âœ… Perguntar > Assumir
```

---

**Posto ProvidÃªncia - Sistema de GestÃ£o de Posto de CombustÃ­veis**
*Desenvolvido com excelÃªncia tÃ©cnica e qualidade de cÃ³digo premium.*