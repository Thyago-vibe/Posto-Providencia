Product Requirements Document (PRD): Baratão Combustíveis
Versão: 1.0 Plataforma Alvo: Mobile (iOS/Android) e Web Responsiva. Tecnologia Frontend: React / React Native. Objetivo: Plataforma de arbitragem de preços de combustível e carteira digital (wallet).

1. Visão Geral do Sistema
O sistema opera como um intermediário financeiro entre o motorista e a rede de postos. O usuário compra "créditos de litragem" antecipadamente para garantir um preço fixo (hedge), e realiza a queima (redemption) desses créditos fisicamente no posto.

O ecossistema é composto por três interfaces:

App do Usuário (Client Side): Compra de créditos, gestão da wallet e geração de token.

App do Frentista/PDV (Operação): Validação de token e baixa de estoque.

Backoffice (Admin): Gestão de preços, conciliação financeira e cadastro de postos.

2. Fluxos e Funcionalidades (App do Usuário)
2.1. Autenticação e Onboarding
Login/Cadastro: Login social (Google/Apple) ou E-mail/Senha.

KYC Simplificado: Validação obrigatória de CPF e Telefone (via OTP) para criação da conta de pagamento.

Gestão de Veículos: CRUD de veículos (Placa, Modelo, Tipo de Combustível Principal) para agilizar o checkout.

2.2. Wallet e Cash-in (Motor Financeiro)
Saldo em Reais (BRL): O usuário deposita valor monetário.

Métodos: Pix (Copy & Paste/QR Code dinâmico) e Cartão de Crédito.

Saldo em Litros (Asset): O sistema deve segregar visualmente o saldo em dinheiro do saldo em produto (Litros de Gasolina/Etanol/Diesel).

Checkout de Conversão:

Input: Valor em R$ ou Quantidade de Litros.

Cálculo: Litros = Valor Input / Preço Ofertado no App.

Output: Atualização imediata do ledger do usuário (Débito em R$ -> Crédito em Litros).

2.3. Redemption (Abastecimento)
Geolocalização: Identificação do posto credenciado mais próximo.

Geração de Ordem de Abastecimento:

O usuário seleciona: Combustível + Quantidade (L) ou "Tanque Cheio" (até o limite do saldo).

Tokenização:

O app gera um QR Code dinâmico ou um PIN numérico de 6 dígitos.

TTL (Time to Live): O token expira em X minutos (ex: 5 min) para evitar fraudes ou compartilhamento de prints.

Feedback de Sucesso: Push notification e tela de sucesso assim que o frentista valida a operação.

2.4. Serviços Agregados (API Integrada)
Consulta de Débitos: Input de Placa/Renavam -> Request para API de despachante/Detran -> Renderização de lista de débitos (IPVA, Multas).

Pagamento de Débitos: Checkout específico com split de pagamento (juros do parcelamento calculados no frontend ou retornados pelo gateway).

3. Requisitos Técnicos do Frontend (React)
3.1. Estado e Gerenciamento
Global State (Zustand/Redux): Necessário para persistir o saldo da wallet e o token de autenticação (JWT) entre as telas sem prop drilling.

Offline First (Parcial): O app deve permitir visualizar o último saldo conhecido e o histórico, mas bloquear a geração de tokens de abastecimento se não houver conexão (para evitar double spending).

3.2. Integrações de API
POST /api/v1/wallet/deposit: Gera payload do Pix ou intenção de compra no cartão.

GET /api/v1/fuel/prices: Busca tabela de preços atualizada por região/posto.

POST /api/v1/transaction/lock: Trava o preço e converte saldo.

POST /api/v1/token/generate: Solicita o token de abastecimento.

WebSocket / Polling: Para ouvir a confirmação de pagamento do Pix e a confirmação de abastecimento pelo frentista em tempo real.

3.3. Segurança no Client-Side
SSL Pinning: Para evitar interceptação de requisições.

Biometria: Exigir FaceID/TouchID antes de confirmar transações de uso de saldo ou geração de token.

4. Interface do Operador (Frentista)
Apenas para contexto da integração, já que o foco é o app do usuário.

Validador: Scanner de QR Code ou Input numérico.

Feedback: Retorna "APROVADO: [Combustível] - [Litros]".

Ação: Botão de "Confirmar Abastecimento" após a entrega do produto físico.

5. Regras de Negócio Críticas (Backend Logic refletida no Front)
Volatilidade de Preço: O preço do combustível no app pode mudar a qualquer momento. O frontend deve ter um timer de atualização ou alerta se o preço mudar durante o checkout.

Travamento de Saldo: Ao gerar um token de abastecimento, o saldo correspondente fica "congelado" (pending). Se o token expirar sem uso, o saldo retorna (rollback).

Limite de Compra: Regras antifraude para impedir que um usuário compre 5.000 litros de uma vez (caracterizando revenda ilegal).

Validade dos Créditos: Se houver regra de expiração (ex: 30 dias), o app deve exibir contagem regressiva.

6. Modelo de Dados Simplificado (Entidades)
User: { id, name, cpf, phone, email }

Wallet: { user_id, balance_brl, balance_gasoline_liters, balance_ethanol_liters, balance_diesel_liters }

Transaction: { id, type (DEPOSIT|CONVERSION|PAYMENT), amount, currency, status, timestamp }

FuelOrder: { id, user_id, station_id, token, status (CREATED|VALIDATED|COMPLETED|EXPIRED) }